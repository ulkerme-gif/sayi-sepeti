<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>SayÄ± Sepeti</title>
<style>
  body { margin:0; background:#87CEEB; font-family:Arial, sans-serif; display:flex; flex-direction:column; align-items:center;}
  #bilgi { width:400px; text-align:center; margin-top:8px; color:#222; }
  canvas { border:3px solid #ff9800; background:transparent; display:block; margin-top:10px; }
  .floating { position:absolute; left:50%; transform:translateX(-50%); font-weight:700; pointer-events:none; }
</style>
</head>
<body>

<div id="bilgi">
  <h2>ðŸŽ¯ SayÄ± Sepeti Oyunu</h2>
  <div>Yapan: <strong>Mete ÃœLKER</strong></div>
  <p>AÅŸama: <span id="asama">1</span> | Puan: <span id="puan">0</span></p>
</div>

<canvas id="game" width="400" height="500"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

let sepet = {x:170, y:420, w:60, h:30};
let puan=0, asama=1;
let hiz=3;
let oyunAktif=false, baslamaEkrani=true, oyunBitti=false;

let sayilar=[], siyahToplar=[];
let effects = { greenPulses:[], redShake:0, levelBursts:[], skyPhase:0 };

const toprakY = 450;

function rasyonelSayi(min=-2,max=2){
  const paydaList=[2,3,4];
  const pay=Math.floor(Math.random()*((max-min+1)))+min || 1;
  const payda=paydaList[Math.floor(Math.random()*paydaList.length)];
  return pay+"/"+payda;
}

function randomXAvoid(existing){
  let x, tries=0;
  do { x=Math.floor(Math.random()*(W-40))+20; tries++; }
  while(existing.some(p=>Math.abs(p-x)<60) && tries<50);
  return x;
}

function rastgeleSayi(asamaIndex, pozisyonlar, index){
  let s={ x:randomXAvoid(pozisyonlar), y:-30, deger:null, tip:null, dogru:false };
  if(asamaIndex===1){
    if(index===0){ s.deger=Math.floor(Math.random()*10); s.tip='dogal'; s.dogru=true; }
    else { if(Math.random()<0.5){ s.deger=-Math.floor(Math.random()*10); s.tip='negatif'; } else { s.deger=rasyonelSayi(); s.tip='rasyonel'; } s.dogru=false; }
  } else if(asamaIndex===2){
    if(index===0){ s.deger=Math.floor(Math.random()*21)-10; s.tip='tam'; s.dogru=true; }
    else { s.deger=rasyonelSayi(); s.tip='rasyonel'; s.dogru=false; }
  } else {
    s.deger=rasyonelSayi(); s.tip='rasyonel'; s.dogru=true;
  }
  return s;
}

function sayilariOlustur(){
  if(!oyunAktif) return;
  sayilar=[]; siyahToplar=[];
  let poz=[];
  const s1=rastgeleSayi(asama, poz, 0); poz.push(s1.x); sayilar.push(s1);
  setTimeout(()=>{
    if(!oyunAktif) return;
    const s2=rastgeleSayi(asama, poz, 1); poz.push(s2.x); sayilar.push(s2);
  },1000);

  const siyahSayisi = (asama===3?2:1);
  for(let i=0;i<siyahSayisi;i++){
    setTimeout(()=>{
      if(!oyunAktif) return;
      let tX=randomXAvoid(poz); poz.push(tX);
      siyahToplar.push({x:tX, y:-20, r:16});
    }, 500+i*100);
  }
}

function addGreenPulse(x,y){ effects.greenPulses.push({x,y,r:8,maxR:60,alpha:1}); }
function addLevelBurst(x,y){ effects.levelBursts.push({x,y,r:10,maxR:120,alpha:1}); }
function triggerRedShake(ms=200){ effects.redShake=Math.max(effects.redShake,ms); }

const skyColors={1:{from:'#bfe9ff',to:'#87CEEB'},2:{from:'#87CEEB',to:'#66b3ff'},3:{from:'#ffcc99',to:'#ff9966'}};

function drawStars(alpha){
  ctx.save(); ctx.globalAlpha=alpha;
  for(let i=0;i<60;i++){ const sx=Math.random()*W; const sy=Math.random()*H*0.6; const s=Math.random()*2; ctx.fillStyle='white'; ctx.fillRect(sx,sy,s,s);}
  ctx.restore();
}

function drawScene(){
  const speed=0.0003*(1+asama*0.6);
  effects.skyPhase=(effects.skyPhase+speed)%1;
  const sc=skyColors[Math.min(asama,3)];
  const g=ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,sc.from); g.addColorStop(1,sc.to);
  ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
  if(oyunBitti){ ctx.fillStyle='rgba(0,0,60,0.4)'; ctx.fillRect(0,0,W,H); drawStars(0.8);}
  ctx.fillStyle='#8B4513'; ctx.fillRect(0, toprakY, W, H-toprakY);

  let shakeOffset=0;
  if(effects.redShake>0){ shakeOffset=(Math.sin(Date.now()/30)*4);}
  ctx.fillStyle='#FF8C00'; ctx.fillRect(sepet.x+shakeOffset,sepet.y,sepet.w,sepet.h);
  ctx.fillStyle='#FFB74D'; ctx.fillRect(sepet.x-5+shakeOffset,sepet.y-15,sepet.w+10,10);

  ctx.font="28px Arial"; ctx.textBaseline='middle';
  sayilar.forEach(s=>{ ctx.fillStyle=(s.tip==='rasyonel')?'#00695c':'#1565c0'; ctx.fillText(String(s.deger),s.x,s.y); });
  siyahToplar.forEach(t=>{ ctx.fillStyle='black'; ctx.beginPath(); ctx.arc(t.x,t.y,t.r,0,Math.PI*2); ctx.fill(); });
  effects.greenPulses.forEach(p=>{ ctx.beginPath(); ctx.fillStyle=`rgba(0,200,0,${p.alpha*0.4})`; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); });
  effects.levelBursts.forEach(b=>{ ctx.beginPath(); ctx.strokeStyle=`rgba(255,220,100,${b.alpha})`; ctx.lineWidth=3; ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.stroke(); });
}

function update(){
  if(effects.redShake>0){ effects.redShake-=16; if(effects.redShake<0) effects.redShake=0; }
  effects.greenPulses.forEach(p=>{ p.r+=5; p.alpha-=0.06; }); effects.greenPulses=effects.greenPulses.filter(p=>p.alpha>0 && p.r<p.maxR);
  effects.levelBursts.forEach(b=>{ b.r+=8; b.alpha-=0.04; }); effects.levelBursts=effects.levelBursts.filter(b=>b.alpha>0 && b.r<b.maxR);

  if(!oyunAktif) return;
  sayilar.forEach(s=>s.y+=hiz);
  siyahToplar.forEach(t=>t.y+=hiz);

  for(let i=sayilar.length-1;i>=0;i--){
    const s=sayilar[i];
    if(s.y>sepet.y-18 && s.x>sepet.x-8 && s.x<sepet.x+sepet.w+8){
      if(s.tip==='rasyonel' && asama<3){ puan-=10; triggerRedShake(); if(puan<0){ resetGame(); return; } }
      else if(s.dogru){ puan+=10; addGreenPulse(sepet.x+sepet.w/2,sepet.y); }
      else { triggerRedShake(); }
      sayilar.splice(i,1);
    } else if(s.y>toprakY+10){ sayilar.splice(i,1);}
  }

  for(let i=siyahToplar.length-1;i>=0;i--){
    const t=siyahToplar[i];
    if(t.y>sepet.y-8 && t.x>sepet.x-8 && t.x<sepet.x+sepet.w+8){ puan-=10; triggerRedShake(); if(puan<0){ resetGame(); return; } siyahToplar.splice(i,1); }
    else if(t.y>toprakY+10){ siyahToplar.splice(i,1);}
  }

  if(sayilar.length===0 && siyahToplar.length===0 && oyunAktif){ setTimeout(()=>{ if(oyunAktif) sayilariOlustur(); },600); }

  if(puan>=60){
    puan=0; asama++;
    if(asama>3){ oyunBitti=true; oyunAktif=false; baslamaEkrani=true; addLevelBurst(W/2,H/2);}
    else { oyunAktif=false; baslamaEkrani=true; hiz+=1; addLevelBurst(W/2,H/2);}
    document.getElementById('asama').innerText=Math.min(asama,3);
    document.getElementById('puan').innerText=puan;
  }

  if(puan<0) puan=0;
  document.getElementById('puan').innerText=puan;
}

function resetGame(){ effects.levelBursts.push({x:W/2,y:H/2,r:10,maxR:200,alpha:1}); puan=0; asama=1; hiz=3; oyunAktif=false; baslamaEkrani=true; oyunBitti=false; sayilar=[]; siyahToplar=[]; document.getElementById('asama').innerText=asama; document.getElementById('puan').innerText=puan; }

function loop(){ drawScene(); update(); requestAnimationFrame(loop); }
window.addEventListener('keydown',e=>{ if(!oyunAktif) return; if(e.key==='ArrowLeft') sepet.x-=20; if(e.key==='ArrowRight') sepet.x+=20; if(sepet.x<0) sepet.x=0; if(sepet.x>W-sepet.w) sepet.x=W-sepet.w; });
let startX=null;
canvas.addEventListener('touchstart', e=>{ if(!oyunAktif) return; startX=e.touches[0].clientX; });
canvas.addEventListener('touchmove', e=>{ if(!oyunAktif) return; const nx=e.touches[0].clientX; const dx=nx-startX; sepet.x+=dx; if(sepet.x<0) sepet.x=0; if(sepet.x>W-sepet.w) sepet.x=W-sepet.w; startX=nx; });

canvas.addEventListener('click', ()=>{
  if(baslamaEkrani){
    if(oyunBitti){ puan=0; asama=1; hiz=3; oyunBitti=false; document.getElementById('asama').innerText=asama; document.getElementById('puan').innerText=puan; }
    baslamaEkrani=false; oyunAktif=true; sayilariOlustur();
  }
});

loop();
</script>
</body>
</html>
