<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sayı Sepeti Oyunu</title>
<style>
  body { margin:0; overflow:hidden; font-family:sans-serif; }
  canvas { display:block; margin:auto; margin-top:20px; border:3px solid #ff9800; }
  #bilgi { text-align:center; font-size:18px; color:#333; }
  #yapan { font-size:16px; color:#555; margin-top:-10px; margin-bottom:10px; }
</style>
</head>
<body>

<div id="bilgi">
  <h2>🎯 Sayı Sepeti Oyunu</h2>
  <div id="yapan">Yapan: <strong>Mete ÜLKER</strong></div>
  <p>Aşama: <span id="asama">1</span> | Puan: <span id="puan">0</span></p>
</div>

<canvas id="oyun" width="400" height="500"></canvas>

<script>
const canvas = document.getElementById("oyun");
const ctx = canvas.getContext("2d");

let sepet = {x:180, y:420, w:60, h:30};
let puan=0, asama=1;
let hiz=3;
let oyunAktif=false;
let baslamaEkrani=true;
let asamaBasladi=false;
let oyunBitti=false;

let sayilar = [];
let siyahToplar = [];

const arkaPlanRenk="#87CEEB";
const toprakRenk="#8B4513";
const toprakY=450;

// Rastgele rasyonel sayı oluştur (kesir)
function rasyonelSayi(min=-2,max=2){
  let pay = Math.floor(Math.random()*((max-min)*4)+min*4);
  let payda = [2,3,4][Math.floor(Math.random()*3)];
  if(pay===0) pay=1;
  return pay+"/"+payda;
}

// Rastgele sayı oluştur
function rastgeleSayi(asamaIndex, pozisyonlar){
  let s={x:Math.random()*350, y:-20, dogru:true, deger:0};
  if(asamaIndex===1){ 
    // 1 sayı yanlış: rasyonel veya negatif
    s.deger=Math.random()<0.5?rasyonelSayi(): -Math.floor(Math.random()*10);
    s.dogru=isNaN(parseInt(s.deger))?false:s.deger>=0 && Number.isInteger(Number(s.deger));
  } else if(asamaIndex===2){
    // 1 sayı yanlış: rasyonel sayı
    s.deger=Math.random()<0.5?rasyonelSayi(): Math.floor(Math.random()*21)-10;
    s.dogru=Number.isInteger(s.deger)?true:false;
  } else {
    // 3. aşama: tüm sayılar doğru rasyonel
    s.deger=rasyonelSayi();
    s.dogru=true;
  }
  // X pozisyonu ayarla (iç içe olmaması)
  while(pozisyonlar.some(p=>Math.abs(p-s.x)<50)){
    s.x=Math.random()*350;
  }
  return s;
}

// Sayıları oluştur
function sayilariOlustur(){
  sayilar=[];
  siyahToplar=[];
  let pozisyonlar=[];
  // 2 sayı
  let s1 = rastgeleSayi(asama, pozisyonlar); pozisyonlar.push(s1.x); sayilar.push(s1);
  setTimeout(()=>{
    let s2 = rastgeleSayi(asama, pozisyonlar); sayilar.push(s2);
  },1000);

  // 1 siyah top
  let t = {x:Math.random()*350, y:-20, r:15};
  while(pozisyonlar.some(p=>Math.abs(p-t.x)<50)){ t.x=Math.random()*350; }
  siyahToplar.push(t);
}

// Çizim
function ciz(){
  ctx.fillStyle=arkaPlanRenk;
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle=toprakRenk;
  ctx.fillRect(0,toprakY,canvas.width,canvas.height-toprakY);

  if(baslamaEkrani){
    ctx.fillStyle="black";
    ctx.font="25px Arial";
    ctx.textAlign="center";
    if(oyunBitti) ctx.fillText("🎉 Oyunu kazandınız! Tekrar oynamak için dokunun",canvas.width/2,canvas.height/2);
    else if(!asamaBasladi) ctx.fillText("Başlamak için tıklayın", canvas.width/2, canvas.height/2);
    else {
      let a = asama===1?"Doğal Sayılar":asama===2?"Tam Sayılar":"Rasyonel Sayılar";
      ctx.fillText("Aşama "+asama+": "+a, canvas.width/2, canvas.height/2-20);
      ctx.fillText("Başlamak için dokun", canvas.width/2, canvas.height/2+20);
    }
    return;
  }

  // Sepet
  ctx.fillStyle="#FF8C00";
  ctx.fillRect(sepet.x,sepet.y,sepet.w,sepet.h);
  ctx.fillStyle="#FFB74D"; // tente
  ctx.fillRect(sepet.x-5,sepet.y-15,sepet.w+10,10);

  // Sayılar
  ctx.font="30px Arial";
  ctx.fillStyle="#1565c0";
  sayilar.forEach(s=> ctx.fillText(s.deger,s.x,s.y));

  // Siyah toplar
  siyahToplar.forEach(t=>{
    ctx.fillStyle="black";
    ctx.beginPath();
    ctx.arc(t.x,t.y,t.r,0,Math.PI*2);
    ctx.fill();
  });

  // Puan
  ctx.fillStyle="black";
  ctx.font="20px Arial";
  ctx.fillText("Puan: "+puan, 300, 30);
}

// Güncelleme
function guncelle(){
  if(!oyunAktif) return;

  // Sayıları düşür
  sayilar.forEach(s=>{
    s.y+=hiz;
    if(s.y>sepet.y-20 && s.x>sepet.x-10 && s.x<sepet.x+sepet.w+10){
      if(!s.dogru) puan-=10; else puan+=10;
      sayilar = sayilar.filter(x=>x!==s);
    }
    else if(s.y>toprakY){
      if(!s.dogru) puan+=10;
      sayilar = sayilar.filter(x=>x!==s);
    }
  });

  // Siyah toplar
  siyahToplar.forEach(t=>{
    t.y+=hiz;
    if(t.y>sepet.y-10 && t.x>sepet.x-10 && t.x<sepet.x+sepet.w+10){
      puan-=10;
      siyahToplar = siyahToplar.filter(x=>x!==t);
    } 
    else if(t.y>toprakY){
      siyahToplar = siyahToplar.filter(x=>x!==t);
    }
  });

  if(sayilar.length==0 && siyahToplar.length==0){
    if(asama>3){
      oyunBitti=true;
      baslamaEkrani=true;
    } else {
      sayilariOlustur();
    }
  }

  if(puan<0) puan=0;
  document.getElementById("puan").innerText=puan;
}

// Oyun döngüsü
function dongu(){ guncelle(); ciz(); requestAnimationFrame(dongu); }
dongu();

// Klavye kontrolleri
window.addEventListener("keydown",(e)=>{
  if(!oyunAktif) return;
  if(e.key==="ArrowLeft") sepet.x-=20;
  if(e.key==="ArrowRight") sepet.x+=20;
  if(sepet.x<0) sepet.x=0;
  if(sepet.x>340) sepet.x=340;
});

// Dokunmatik kontroller
let baslamaX=null;
canvas.addEventListener("touchstart",(e)=>{
  if(!oyunAktif) return;
  baslamaX=e.touches[0].clientX;
});
canvas.addEventListener("touchmove",(e)=>{
  if(!oyunAktif) return;
  let hareket=e.touches[0].clientX-baslamaX;
  sepet.x+=hareket;
  if(sepet.x<0) sepet.x=0;
  if(sepet.x>340) sepet.x=340;
  baslamaX=e.touches[0].clientX;
});

// Başlama tıklaması
canvas.addEventListener("click",()=>{
  if(baslamaEkrani){
    if(oyunBitti){
      // Baştan başlat
      asama=1; puan=0; hiz=3; oyunBitti=false;
    }
    baslamaEkrani=false;
    oyunAktif=true;
    asamaBasladi=true;
    sayilariOlustur();
    document.getElementById("puan").innerText=puan;
    document.getElementById("asama").innerText=asama;
  }
});
</script>
</body>
</html>
